"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[1458],{"./packages/design-system/src/icons/lock_closed.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _path,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_extends.apply(this,arguments)}const SvgLockClosed=_ref=>{let{title,titleId,...props}=_ref;return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 32","aria-labelledby":titleId},props),title?react__WEBPACK_IMPORTED_MODULE_0__.createElement("title",{id:titleId},title):null,_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M16 8a3 3 0 0 0-3 3v3h-1.5a1.5 1.5 0 0 0-1.5 1.5v7a1.5 1.5 0 0 0 1.5 1.5h9a1.5 1.5 0 0 0 1.5-1.5v-7a1.5 1.5 0 0 0-1.5-1.5H19v-3a3 3 0 0 0-3-3Zm2 6v-3a2 2 0 1 0-4 0v3h4Zm-4.5 1h-2a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5h-7Zm2.5 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z",clipRule:"evenodd"})))},__WEBPACK_DEFAULT_EXPORT__=(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(SvgLockClosed)},"./packages/dashboard/src/app/views/myStories/content/storyGridView/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>storyGridView});__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var i18n=__webpack_require__("./packages/i18n/src/i18n.ts"),styled_components_browser_esm=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),src=__webpack_require__("./packages/react/src/index.ts"),useGridViewKeys=__webpack_require__("./packages/design-system/src/components/keyboard/gridview/useGridViewKeys.ts"),components=__webpack_require__("./packages/dashboard/src/components/index.js"),constants=(__webpack_require__("./packages/dashboard/src/propTypes.js"),__webpack_require__("./packages/dashboard/src/constants/index.ts")),config=__webpack_require__("./packages/dashboard/src/app/config/index.ts"),visuallyHidden=__webpack_require__("./packages/design-system/src/components/visuallyHidden.ts"),date_src=__webpack_require__("./packages/date/src/index.ts"),sprintf=__webpack_require__("./packages/i18n/src/sprintf.ts"),story_menu_generator=__webpack_require__("./packages/dashboard/src/components/popoverMenu/story-menu-generator.js"),utils=__webpack_require__("./packages/dashboard/src/utils/index.js"),grid_components=__webpack_require__("./packages/dashboard/src/app/views/shared/grid/components.js"),headline=__webpack_require__("./packages/design-system/src/components/typography/headline/index.ts"),types=__webpack_require__("./packages/design-system/src/theme/types.ts"),typography_text=__webpack_require__("./packages/design-system/src/components/typography/text/index.ts"),lock_closed=__webpack_require__("./packages/design-system/src/icons/lock_closed.svg"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types);const CustomCardGridItem=(0,styled_components_browser_esm.ZP)(components.DT).withConfig({displayName:"storyGridItem__CustomCardGridItem",componentId:"sc-1vhey8s-0"})(["display:grid;grid-template-columns:100%;grid-template-rows:",";"],(_ref=>{let{$posterHeight}=_ref;return`${$posterHeight}px auto`}));CustomCardGridItem.propTypes={$posterHeight:prop_types_default().number};const CardWrapper=styled_components_browser_esm.ZP.div.withConfig({displayName:"storyGridItem__CardWrapper",componentId:"sc-1vhey8s-1"})(["position:absolute;height:100%;width:100%;"]),ScrimAnchor=styled_components_browser_esm.ZP.a.withConfig({displayName:"storyGridItem__ScrimAnchor",componentId:"sc-1vhey8s-2"})(["position:absolute;top:0;width:100%;height:100%;box-sizing:border-box;border-radius:",";&:hover,&:focus{box-shadow:none;border:",";}"],(_ref2=>{let{theme}=_ref2;return theme.borders.radius.medium}),(_ref3=>{let{theme}=_ref3;return`4px solid ${theme.colors.interactiveBg.active}`})),StyledStoryDisplayContent=styled_components_browser_esm.ZP.div.withConfig({displayName:"storyGridItem__StyledStoryDisplayContent",componentId:"sc-1vhey8s-3"})(["padding:20px 12px 8px 12px;display:flex;flex-direction:column;width:100%;"]),Row=styled_components_browser_esm.ZP.div.withConfig({displayName:"storyGridItem__Row",componentId:"sc-1vhey8s-4"})(["width:100%;display:flex;align-items:flex-end;flex-wrap:wrap;"]),LockedRow=(0,styled_components_browser_esm.ZP)(Row).withConfig({displayName:"storyGridItem__LockedRow",componentId:"sc-1vhey8s-5"})(["position:absolute;top:8px;right:8px;justify-content:flex-end;align-items:center;"]),CardDetailsGrid=styled_components_browser_esm.ZP.div.withConfig({displayName:"storyGridItem__CardDetailsGrid",componentId:"sc-1vhey8s-6"})(["display:grid;grid-template-columns:80% auto;margin-top:4px;"]),CardDetailsColumn=styled_components_browser_esm.ZP.div.withConfig({displayName:"storyGridItem__CardDetailsColumn",componentId:"sc-1vhey8s-7"})(["display:flex;align-items:space-between;flex-direction:column;align-self:flex-end;"]),Title=(0,styled_components_browser_esm.ZP)(headline.s).attrs({as:"h3",size:types.TextSize.XSmall}).withConfig({displayName:"storyGridItem__Title",componentId:"sc-1vhey8s-8"})(["overflow:hidden;text-overflow:ellipsis;color:",";margin:0;max-height:calc(1.2em * 3);display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;"],(_ref4=>{let{theme}=_ref4;return theme.colors.inverted.fg.primary})),DetailCopy=(0,styled_components_browser_esm.ZP)(typography_text.x.Span).attrs({size:types.TextSize.XSmall}).withConfig({displayName:"storyGridItem__DetailCopy",componentId:"sc-1vhey8s-9"})(["color:",";margin:0;"],(_ref5=>{let{theme}=_ref5;return theme.colors.inverted.fg.primary})),LockAvatar=styled_components_browser_esm.ZP.img.withConfig({displayName:"storyGridItem__LockAvatar",componentId:"sc-1vhey8s-10"})(["height:40px;width:40px;border:",";border-radius:",";z-index:3;"],(_ref6=>{let{theme}=_ref6;return`2px solid ${theme.colors.interactiveBg.brandNormal}`}),(_ref7=>{let{theme}=_ref7;return theme.borders.radius.small})),LockIcon=(0,styled_components_browser_esm.ZP)(lock_closed.Z).withConfig({displayName:"storyGridItem__LockIcon",componentId:"sc-1vhey8s-11"})(["color:",";display:inline;height:36px;width:36px;margin:-4px -4px -4px -10px;"],(_ref8=>{let{theme}=_ref8;return theme.colors.inverted.fg.primary}));var popup_constants=__webpack_require__("./packages/design-system/src/components/popup/constants.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const StoryDisplayContent=_ref=>{let{author,contextMenu,displayDate,editMode,formattedTitle,id,isLocked,lockUser={},onEditComplete,onEditCancel,status,title}=_ref;const displayDateText=(0,src.Ye)((()=>{if(!displayDate)return null;switch(status){case constants.HZ.PUBLISH:return(0,sprintf.Z)((0,i18n.__)("Published %s","web-stories"),displayDate);case constants.HZ.FUTURE:return(0,sprintf.Z)((0,i18n.__)("Scheduled %s","web-stories"),displayDate);default:return(0,sprintf.Z)((0,i18n.__)("Modified %s","web-stories"),displayDate)}}),[status,displayDate]),{name,avatar}=lockUser,storyLockedTitle=isLocked&&avatar&&(0,jsx_runtime.jsx)(LockedRow,{children:(0,jsx_runtime.jsx)(components.u,{position:popup_constants.ug.BottomStart,title:name&&(0,sprintf.Z)((0,i18n.__)("%s is currently editing this story","web-stories"),name),children:(0,jsx_runtime.jsx)(LockAvatar,{src:avatar,alt:name,decoding:"async",height:24,width:24,"data-test-id":"lock-user-avatar"})})});return(0,jsx_runtime.jsxs)(StyledStoryDisplayContent,{children:[storyLockedTitle,editMode?(0,jsx_runtime.jsx)(components._m,{onEditComplete,onEditCancel,value:title,id,label:(0,i18n.__)("Rename story","web-stories"),isInverted:!0}):(0,jsx_runtime.jsxs)(Row,{children:[isLocked&&(0,jsx_runtime.jsx)(LockIcon,{}),(0,jsx_runtime.jsx)(Title,{children:formattedTitle})]}),(0,jsx_runtime.jsxs)(CardDetailsGrid,{children:[(0,jsx_runtime.jsxs)(CardDetailsColumn,{children:[status===constants.HZ.DRAFT&&(0,jsx_runtime.jsx)(DetailCopy,{isBold:!0,children:(0,i18n.__)("Draft","web-stories")}),status===constants.HZ.PENDING&&(0,jsx_runtime.jsx)(DetailCopy,{isBold:!0,children:(0,i18n.__)("Pending","web-stories")}),author?.name&&(0,jsx_runtime.jsx)(DetailCopy,{children:author?.name}),(0,jsx_runtime.jsx)(DetailCopy,{className:"dashboard-grid-item-date",children:displayDateText})]}),(0,jsx_runtime.jsx)(CardDetailsColumn,{children:contextMenu})]})]})};StoryDisplayContent.displayName="StoryDisplayContent";const storyDisplayContent=StoryDisplayContent,StoryGridItem=(0,src.Gp)(((_ref,ref)=>{let{onFocus,isActive,pageSize,renameStory,story,storyMenu}=_ref;const{userId}=(0,config.Z)(),tabIndex=isActive?0:-1,titleRenameProps=renameStory?{editMode:renameStory?.id===story?.id,onEditComplete:newTitle=>renameStory?.handleOnRenameStory(story,newTitle),onEditCancel:renameStory?.handleCancelRename}:{},isLocked=(0,src.Ye)((()=>story?.locked&&userId!==story?.lockUser.id),[story,userId]),generatedMenuItems=(0,src.Ye)((()=>(0,story_menu_generator.r)({menuItems:storyMenu.menuItems,story,isLocked})),[storyMenu,story,isLocked]),storyDate=(0,date_src.t9)(story?.status===constants.HZ.DRAFT?story?.modifiedGmt:story?.createdGmt),formattedTitle=(0,utils.VU)(story.title),memoizedStoryMenu=(0,src.Ye)((()=>generatedMenuItems.length?(0,jsx_runtime.jsx)(components.IC,{menuLabel:isLocked?(0,sprintf.Z)((0,i18n.__)("Context menu for %1$s (locked by %2$s)","web-stories"),formattedTitle,story?.lockUser.name):(0,sprintf.Z)((0,i18n.__)("Context menu for %s","web-stories"),formattedTitle),itemActive:isActive,tabIndex,onMoreButtonSelected:storyMenu.handleMenuToggle,contextMenuId:storyMenu.contextMenuId,storyId:story.id,isInverted:!0,menuItems:generatedMenuItems,menuStyleOverrides:(0,styled_components_browser_esm.iv)(["margin:0 0 0 auto;"])}):null),[isLocked,formattedTitle,story?.lockUser?.name,story.id,isActive,tabIndex,storyMenu,generatedMenuItems]);return(0,jsx_runtime.jsx)(CustomCardGridItem,{"data-testid":`story-grid-item-${story.id}`,onFocus,$posterHeight:pageSize.height,ref,"aria-label":(0,sprintf.Z)((0,i18n.__)("Details about %s","web-stories"),formattedTitle),children:(0,jsx_runtime.jsx)(grid_components.W2,{children:(0,jsx_runtime.jsxs)(CardWrapper,{children:[(0,jsx_runtime.jsx)(grid_components.Wf,{...story.featuredMediaUrl?{alt:(0,sprintf.Z)((0,i18n.__)("%s Poster image","web-stories"),formattedTitle),as:"img",src:story.featuredMediaUrl,decoding:"async"}:null,width:constants.R8,height:constants.j$}),(0,jsx_runtime.jsx)(grid_components.ph,{}),(0,jsx_runtime.jsxs)(grid_components.ZM,{children:[story?.capabilities?.hasEditAction&&(0,jsx_runtime.jsx)(ScrimAnchor,{className:"grid-item-anchor","data-testid":"story-editor-grid-link",tabIndex,href:story.editStoryLink,children:(0,jsx_runtime.jsx)(visuallyHidden.T,{children:(0,sprintf.Z)((0,i18n.__)("Open %s in Editor","web-stories"),formattedTitle)})}),(0,jsx_runtime.jsx)(storyDisplayContent,{author:story.author,contextMenu:memoizedStoryMenu,displayDate:storyDate,formattedTitle,id:story.id,isLocked,lockUser:story?.lockUser,status:story?.status,title:story.title,...titleRenameProps})]})]})})})}));StoryGridItem.displayName="StoryGridItem";const storyGridItem=StoryGridItem,StoryGrid=(0,styled_components_browser_esm.ZP)(components.gy).withConfig({displayName:"storyGridView__StoryGrid",componentId:"sc-1fwq7hb-0"})(["width:calc(100% - ","px);"],constants.su.GUTTER),StoryGridView=_ref=>{let{stories,pageSize,storyMenu,renameStory,returnStoryFocusId}=_ref;const{isRTL}=(0,config.Z)(),containerRef=(0,src.sO)(),gridRef=(0,src.sO)(),itemRefs=(0,src.sO)({}),[activeGridItemId,setActiveGridItemId]=(0,src.eJ)(),activeGridItemIdRef=(0,src.sO)(),gridItemIds=(0,src.Ye)((()=>stories.map((_ref2=>{let{id}=_ref2;return id}))),[stories]);(0,useGridViewKeys.Z)({containerRef,gridRef,itemRefs,isRTL,currentItemId:activeGridItemId,items:stories}),(0,src.d4)((()=>{if(!activeGridItemId&&returnStoryFocusId?.value&&!activeGridItemIdRef.current){const newFocusId=returnStoryFocusId?.value;setActiveGridItemId(newFocusId);const firstFocusableElement=itemRefs.current?.[newFocusId]?.querySelectorAll(["button","a"])?.[0];firstFocusableElement?.focus()}}),[activeGridItemId,returnStoryFocusId]),(0,src.d4)((()=>{activeGridItemId&&(activeGridItemIdRef.current=activeGridItemId)}),[activeGridItemId]);const handleMenuToggle=(0,src.I4)(((evt,id)=>{if(storyMenu.handleMenuToggle(id),id<0&&9===evt?.keyCode){const idToFocus=!evt?.shiftKey?gridItemIds[gridItemIds.indexOf(activeGridItemId)+1]:activeGridItemId;returnStoryFocusId.set(idToFocus),activeGridItemIdRef.current=null,setActiveGridItemId(null)}}),[activeGridItemId,gridItemIds,returnStoryFocusId,storyMenu]),manuallySetFocusOut=(0,src.I4)((()=>{activeGridItemIdRef.current=null,setActiveGridItemId(null),returnStoryFocusId.set(null)}),[returnStoryFocusId]);(0,src.FR)(containerRef,(()=>setActiveGridItemId(null)),[]);const modifiedStoryMenu=(0,src.Ye)((()=>{const actions=[constants.D6.DELETE,constants.D6.RENAME,constants.D6.DUPLICATE],menuItems=storyMenu.menuItems.map((item=>{const _item={...item};return actions.includes(item?.value)&&(_item.action=story=>{manuallySetFocusOut(),item.action(story)}),_item}));return{...storyMenu,handleMenuToggle,menuItems}}),[handleMenuToggle,storyMenu,manuallySetFocusOut]),memoizedStoryGrid=(0,src.Ye)((()=>stories.map((story=>(0,jsx_runtime.jsx)(storyGridItem,{onFocus:()=>setActiveGridItemId(story.id),isActive:activeGridItemId===story.id,ref:el=>{itemRefs.current[story.id]=el},pageSize,renameStory,story,storyMenu:modifiedStoryMenu},story.id)))),[activeGridItemId,modifiedStoryMenu,pageSize,renameStory,stories]);return(0,jsx_runtime.jsx)("div",{ref:containerRef,children:(0,jsx_runtime.jsx)(StoryGrid,{pageSize,ref:gridRef,role:"list",ariaLabel:(0,i18n.__)("Viewing stories","web-stories"),children:memoizedStoryGrid})})};StoryGridView.displayName="StoryGridView";const storyGridView=StoryGridView},"./packages/dashboard/src/app/views/shared/grid/components.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W2:()=>Container,Wf:()=>Poster,ZM:()=>Scrim,ph:()=>Gradient});var styled_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js");const Gradient=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.div.withConfig({displayName:"grid__Gradient",componentId:"sc-fbjjp8-0"})(["position:absolute;bottom:0;height:67%;width:100%;border-radius:",";background:",";"],(_ref=>{let{theme}=_ref;return theme.borders.radius.medium}),(_ref2=>{let{theme}=_ref2;return theme.colors.gradient.posterOverlay})),Scrim=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.div.withConfig({displayName:"grid__Scrim",componentId:"sc-fbjjp8-1"})(["position:absolute;top:0;width:100%;height:100%;box-sizing:border-box;display:flex;flex-direction:column;justify-content:flex-end;border-radius:",";background:",";"],(_ref3=>{let{theme}=_ref3;return theme.borders.radius.medium}),(_ref4=>{let{theme}=_ref4;return theme.colors.opacity.black3})),Container=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.div.withConfig({displayName:"grid__Container",componentId:"sc-fbjjp8-2"})(["position:relative;"]),Poster=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.div.withConfig({displayName:"grid__Poster",componentId:"sc-fbjjp8-3"})(["height:100%;width:100%;object-fit:cover;border-radius:",";background:",";"],(_ref5=>{let{theme}=_ref5;return theme.borders.radius.medium}),(_ref6=>{let{theme}=_ref6;return theme.colors.gradient.placeholder}))},"./packages/dashboard/src/components/popoverMenu/story-menu-generator.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{r:()=>generateStoryMenu});__webpack_require__("./node_modules/core-js/modules/esnext.iterator.constructor.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.find.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.filter.js"),__webpack_require__("./node_modules/core-js/modules/esnext.iterator.map.js");var _constants__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./packages/dashboard/src/constants/index.ts"),_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./packages/dashboard/src/utils/index.js");const generateStoryMenu=_ref=>{let{menuItems,story,isLocked}=_ref;const defaultFn=menuItems.default?()=>menuItems.default(story):_utils__WEBPACK_IMPORTED_MODULE_5__.ZT;return menuItems.filter((item=>void 0===item.isEnabled||item.isEnabled(story))).map((_ref2=>{let{capability,value,...menuItem}=_ref2;const menu=(value=>menuItems.find((item=>item?.value===value)))(value),extraProperties={onClick:menu?()=>menu.action(story):defaultFn};switch(value){case _constants__WEBPACK_IMPORTED_MODULE_4__.D6.OPEN_IN_EDITOR:extraProperties.href=story.bottomTargetAction,extraProperties.openNewTab=!1;break;case _constants__WEBPACK_IMPORTED_MODULE_4__.D6.OPEN_STORY_LINK:extraProperties.href=story.previewLink,extraProperties.openNewTab=!0;break;case _constants__WEBPACK_IMPORTED_MODULE_4__.D6.RENAME:case _constants__WEBPACK_IMPORTED_MODULE_4__.D6.DELETE:extraProperties.disabled=isLocked}return delete menuItem?.action,{...menuItem,...extraProperties}}))}},"./packages/design-system/src/components/visuallyHidden.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>VisuallyHidden});var styled_components__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js"),_theme_helpers__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./packages/design-system/src/theme/helpers/visuallyHidden.ts");const VisuallyHidden=styled_components__WEBPACK_IMPORTED_MODULE_0__.ZP.span.withConfig({displayName:"visuallyHidden__VisuallyHidden",componentId:"sc-35d3te-0"})(["",";"],_theme_helpers__WEBPACK_IMPORTED_MODULE_1__.j)}}]);